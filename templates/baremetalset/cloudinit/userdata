#cloud-config
# overwrite the fqdn set by metal3 wit the one generated by the baremetalset
fqdn: {{ .Hostname }}{{ if .DomainName }}.{{ .DomainName }}{{ end }}
users:
  - name: cloud-admin
    ssh-authorized-keys: {{ .AuthorizedKeys }}
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    shell: /bin/bash
{{- if .NodeRootPassword }}
chpasswd:
  list: |
    root:{{ .NodeRootPassword }}
  expire: False
{{- end }}
bootcmd:
  # fix BLS entries
  - set -x; if [ -e /boot/loader/entries/ffffffffffffffffffffffffffffffff-* ]; then MACHINEID=$(cat /etc/machine-id) && rename "ffffffffffffffffffffffffffffffff" "$MACHINEID" /boot/loader/entries/ffffffffffffffffffffffffffffffff-* ; fi
runcmd:
  # grow volumes on hardened image if command exists
  - if [ -e /usr/local/sbin/growvols ]; then /usr/local/sbin/growvols --yes /=8GB /tmp=1GB /var/log=10GB /var/log/audit=2GB /home=1GB /var=100%; fi
